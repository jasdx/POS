<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jazmin is great</title>
    
    <link rel="icon" type="image" href="jaz.jpg">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- CSS STYLES: PROFESSIONAL TEAL/GOLD THEME --- */
        :root {
            --primary-color: #004D40; /* Deep Professional Teal */
            --secondary-color: #FFC107; /* Gold/Amber - Accent/Action Color */
            --accent-color: #E0F2F1; /* Very Light Teal/Mint - Card Background */
            --danger-color: #D32F2F; /* Deep Red for Rates and Danger */
            --warning-color: #FF9800; /* Orange for warning/edit */
            --background-color: #F5F5F5; /* Light Grey for clean backdrop */
            --card-background: #FFFFFF; /* Clean White */
            --border-color: #CCC;
            --text-color: #212121;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
        }
        
        /* --- HEADER & BRANDING --- */
        .header-brand {
            background-color: var(--card-background); 
            color: var(--text-color); 
            padding: 15px 0;
            text-align: center;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); 
            margin-bottom: 15px;
        }

        .header-brand h1 {
            font-size: 2.2rem;
            font-weight: 800;
            letter-spacing: 2px;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* --- LOGO IMAGE --- */
        .header-brand img {
            height: 100px; 
            width: auto;
            /* Removed border-radius and border for a more generic random image look */
            padding: 0; 
            background-color: transparent; 
        }

        .pos-container {
            display: flex;
            max-width: 1400px;
            margin: 10px auto;
            gap: 15px;
            min-height: 90vh;
            padding: 0 10px;
        }

        /* --- CARD STYLING --- */
        .card {
            background: var(--card-background);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .product-catalog {
            flex: 3;
            display: flex;
            flex-direction: column;
        }

        .product-catalog h2 {
            margin-bottom: 10px;
            color: var(--primary-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 8px;
            font-size: 1.5em;
        }

        .category-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }

        .category-tab {
            padding: 8px 12px;
            background-color: #f0f0f0;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
        }

        .category-tab.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); 
            gap: 8px;
            flex-grow: 1; 
            overflow-y: auto;
            padding-right: 5px; 
        }

        /* --- PRODUCT CARD HEIGHT FIX (Adjusted for better screen density) --- */
        .product-card {
            background: var(--accent-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            text-align: center;
            transition: transform 0.1s, box-shadow 0.1s;
            cursor: pointer;
            min-height: 110px; /* Slightly shorter */
            max-height: 130px; /* Slightly shorter */
        }

        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .product-name {
            font-size: 0.85em;
            font-weight: bold;
            margin-bottom: 4px;
            flex-grow: 1; 
            line-height: 1.2;
            color: var(--primary-color);
            overflow: hidden; 
            text-overflow: ellipsis; 
            display: -webkit-box;
            -webkit-line-clamp: 2; 
            -webkit-box-orient: vertical;
        }

        .product-rate {
            font-size: 1em;
            color: var(--danger-color);
            margin-bottom: 6px;
            font-weight: 600;
        }

        .add-to-cart-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            width: 100%;
            transition: background-color 0.1s;
        }

        .add-to-cart-btn:hover {
            background-color: #00796B; 
        }

        /* --- RIGHT SIDE: Order Details (COMPACT FOR POS) --- */
        .order-details {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 10px; 
        }
        
        .customer-info-box h3, .order-summary-box h3 {
            font-size: 1.2em;
            margin-bottom: 6px; 
        }
        
        /* Unified input/textarea styling for compact POS look */
        .card input, .card textarea {
            width: 100%;
            padding: 6px; 
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.9em;
        }

        .customer-info-box input {
             margin-bottom: 6px; 
        }
        
        #cust-note {
            margin-top: 10px; 
            min-height: 50px; 
            resize: vertical;
        }

        /* --- Cart Item Styling for clarity --- */
        .cart-items {
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 5px;
            max-height: 200px; 
            overflow-y: auto;
            margin-bottom: 8px;
        }

        .cart-item {
            display: grid;
            grid-template-columns: 3fr 2fr 1.5fr; 
            align-items: center;
            padding: 6px 0; 
            border-bottom: 1px dashed #eee;
            font-size: 0.85em; 
        }

        .item-controls button {
            background-color: var(--secondary-color);
            color: var(--text-color);
            width: 20px;
            height: 20px;
            border-radius: 4px;
            line-height: 1;
            font-size: 1em;
        }

        .item-total {
            color: var(--danger-color);
        }

        .totals {
            padding-top: 8px;
        }

        .total-row {
            padding: 3px 0;
            font-size: 0.95em;
        }

        .grand-total {
            font-size: 1.1em;
            color: var(--primary-color);
            border-top: 2px solid var(--primary-color);
            margin-top: 4px;
            padding-top: 4px !important;
        }

        /* Saved Orders Box Styling */
        .saved-orders-box {
            border-top: 1px solid #eee;
            margin-top: 5px;
            padding-top: 10px;
        }
        
        .saved-orders-list {
            max-height: 150px; 
            margin-bottom: 8px;
        }
        
        .saved-order-item {
            padding: 6px 8px;
            font-size: 0.85em; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px dotted var(--border-color);
        }
        .saved-order-item:last-child {
            border-bottom: none;
        }
        
        /* --- BUTTON STYLING --- */
        .order-actions button {
            padding: 5px 8px;
            font-size: 0.8em;
            margin-left: 5px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            color: white; 
            font-weight: 500;
            transition: background-color 0.1s;
        }

        .order-actions .edit-order-btn {
            background-color: var(--warning-color);
            color: var(--text-color); 
        }
        
        .order-actions .send-order-btn-small {
            background-color: #25D366; /* WhatsApp Green */
            color: white;
        }
        
        .order-actions .remove-order-btn {
            background-color: var(--danger-color);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px; 
            margin-top: 10px; 
        }
        
        .action-buttons button {
            flex: 1;
            padding: 10px; 
            font-size: 0.9em;
        }

        #remove-all-orders-btn {
            background-color: var(--danger-color);
            transition: background-color 0.1s;
        }
        #remove-all-orders-btn:hover {
            background-color: #B71C1C;
        }


        /* --- RESPONSIVE ADJUSTMENTS --- */
        /* Tablet & Mobile Layout (under 900px) */
        @media (max-width: 900px) {
            .pos-container {
                flex-direction: column;
                min-height: auto;
                padding: 0;
                margin: 0;
            }
            /* Order details first, then product catalog */
            .order-details { order: 1; gap: 0; }
            .product-catalog { order: 2; border-radius: 0; }
            
            /* Constrain height of primary scrollable areas on mobile */
            .product-grid { max-height: 40vh; }
            .cart-items { max-height: 150px; }

            /* Full width look */
            .card { border-radius: 0; box-shadow: none; }
            .header-brand { border-radius: 0; margin-bottom: 0; }
        }

        /* Narrow Mobile Device Optimization (under 480px) */
        @media (max-width: 480px) {
            .header-brand h1 {
                font-size: 1.1rem;
                margin-right:35px; 
            }
            .header-brand img {
                height: 80px;
                
            }
            /* Make product grid items smaller to fit more products across */
            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); 
            }
            .product-card {
                min-height: 100px;
                max-height: 120px;
                padding: 6px;
            }
            .product-name {
                font-size: 0.8em;
            }
            .add-to-cart-btn {
                padding: 4px 8px;
                font-size: 0.8em;
            }
            .saved-order-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="header-brand">
        <h1>
            
           <img src="jaz.jpg" alt="jaz">
            JAZMIN TEST POS
        </h1>
    </div>

    <div class="pos-container">
        
<div class="card product-catalog">
            <h2>Product Catalog</h2>
            <div id="category-tabs" class="category-tabs">
                
</div>
            <div id="product-list" class="product-grid">
                <p>Loading products...</p>
            </div>
        </div>

        
<div class="order-details">
            <div class="card customer-info-box">
                <h3>Customer Details</h3>
                <input type="text" id="cust-name" placeholder="Name (Required)" class="rounded-md">
                <input type="tel" id="cust-contact" placeholder="Contact/WhatsApp No. (Required)" class="rounded-md">
                <input type="text" id="cust-address" placeholder="Address" class="rounded-md">
            </div>

            <div class="card order-summary-box">
                <h3>Current Order</h3>
                <div id="cart-items" class="cart-items">
                    <p class="empty-cart-msg" style="display: block;">No products added yet.</p>
                </div>
                
                
<div class="totals">
                    <div class="total-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">Rs.0.00</span>
                    </div>
                    <div class="total-row grand-total">
                        <span>Grand Total:</span>
                        <span id="grand-total">Rs.0.00</span>
                    </div>
                </div>

                
<textarea id="cust-note" placeholder="Order Notes/Comments" class="rounded-md"></textarea>
                
                
<div class="saved-orders-box">
                    <h3>Saved/Pending Orders</h3>
                    <div id="saved-orders-list" class="saved-orders-list">
                        <div class="no-saved-orders p-2 text-center text-gray-500">No saved orders found.</div>
                    </div>
                </div>

                
<div class="action-buttons">
                    <button id="save-order-btn" class="bg-yellow-500 hover:bg-yellow-600 text-gray-800 p-3 rounded-md font-bold" title="Save current order and clear form" disabled>Save Order</button>
                    <button id="new-order-btn" class="bg-gray-500 hover:bg-gray-600 text-white p-3 rounded-md font-bold" title="Clear current cart and customer details">New Order</button>
                </div>
                
                
<button id="send-current-order-btn" class="w-full mt-3 bg-[#25D366] hover:bg-[#1DA851] text-white p-3 rounded-md font-bold" title="Send current order details via WhatsApp" disabled>Send Current Order</button>
                
<button id="remove-all-orders-btn" class="w-full mt-3 bg-red-600 hover:bg-red-700 text-white p-2 rounded-md font-semibold" disabled>Remove All Saved Orders</button>
            </div>
        </div>
    </div>
    
 <script type="application/json" id="product-data-json">
    [
  { "id": 1, "name": "Classic Caesar Salad", "rate": 12.99, "category": "Salads" },
  { "id": 2, "name": "Crispy Calamari Rings", "rate": 14.50, "category": "Appetizers" },
  { "id": 3, "name": "Garlic Butter Prawns", "rate": 18.25, "category": "Appetizers" },
  { "id": 4, "name": "Bruschetta Pomodoro", "rate": 9.95, "category": "Appetizers" },
  { "id": 5, "name": "Roasted Tomato Basil Soup", "rate": 7.50, "category": "Soups" },
  { "id": 6, "name": "Wild Mushroom Risotto", "rate": 21.00, "category": "Main Course" },
  { "id": 7, "name": "Ribeye Steak (300g)", "rate": 34.99, "category": "Main Course" },
  { "id": 8, "name": "Pan-Seared Sea Bass", "rate": 28.50, "category": "Main Course" },
  { "id": 9, "name": "Fettuccine Alfredo", "rate": 16.45, "category": "Pasta" },
  { "id": 10, "name": "Spaghetti Carbonara", "rate": 17.50, "category": "Pasta" },
  { "id": 11, "name": "Vegetarian Lasagna", "rate": 15.99, "category": "Pasta" },
  { "id": 12, "name": "BBQ Chicken Pizza", "rate": 19.00, "category": "Pizza" },
  { "id": 13, "name": "Quattro Formaggi Pizza", "rate": 20.50, "category": "Pizza" },
  { "id": 14, "name": "Truffle Beef Burger", "rate": 18.75, "category": "Burgers" },
  { "id": 15, "name": "Grilled Halloumi Burger", "rate": 14.25, "category": "Burgers" },
  { "id": 16, "name": "Lamb Shish Kebab", "rate": 22.00, "category": "Grill" },
  { "id": 17, "name": "Honey Glazed Salmon", "rate": 26.50, "category": "Main Course" },
  { "id": 18, "name": "Chicken Tikka Masala", "rate": 18.95, "category": "Main Course" },
  { "id": 19, "name": "Steamed Jasmine Rice", "rate": 4.50, "category": "Sides" },
  { "id": 20, "name": "Sweet Potato Fries", "rate": 6.25, "category": "Sides" },
  { "id": 21, "name": "Saut√©ed Broccolini", "rate": 7.00, "category": "Sides" },
  { "id": 22, "name": "New York Cheesecake", "rate": 8.95, "category": "Desserts" },
  { "id": 23, "name": "Tiramisu della Casa", "rate": 9.50, "category": "Desserts" },
  { "id": 24, "name": "Chocolate Fondant", "rate": 10.25, "category": "Desserts" },
  { "id": 25, "name": "Classic Mojito", "rate": 11.00, "category": "Cocktails" },
  { "id": 26, "name": "Espresso Martini", "rate": 12.50, "category": "Cocktails" },
  { "id": 27, "name": "Fresh Orange Juice", "rate": 5.50, "category": "Beverages" },
  { "id": 28, "name": "Sparkling Mineral Water", "rate": 3.50, "category": "Beverages" },
  { "id": 29, "name": "Double Espresso", "rate": 3.25, "category": "Beverages" },
  { "id": 30, "name": "Earl Grey Tea", "rate": 3.00, "category": "Beverages" }
]
</script>
    

    <script>
        // --- JAVASCRIPT LOGIC ---

        document.addEventListener('DOMContentLoaded', () => {
            
            // --- 1. Data Initialization & Constants ---
            const CURRENCY_SYMBOL = "Rs.";
            const LOCAL_STORAGE_KEY = 'pos_saved_orders';
            
            // Load product data from the embedded JSON script tag
            const productDataScript = document.getElementById('product-data-json');
            let productData = [];
            try {
                productData = JSON.parse(productDataScript.textContent);
            } catch (e) {
                console.error("Error parsing product data JSON:", e);
                // Reverted to window.alert for critical error
                window.alert("Failed to load product data. Check the JSON syntax.");
            }

            const productsById = productData.reduce((acc, p) => {
                acc[p.id] = p;
                return acc;
            }, {});

            const categoriesMap = productData.reduce((acc, p) => {
                if (!acc[p.category]) {
                    acc[p.category] = [];
                }
                acc[p.category].push(p);
                return acc;
            }, {});

            const allCategories = Object.keys(categoriesMap);
            
            // --- 2. DOM Elements & State ---
            const productListEl = document.getElementById('product-list');
            const categoryTabsEl = document.getElementById('category-tabs');
            const cartItemsEl = document.getElementById('cart-items');
            const subtotalEl = document.getElementById('subtotal');
            const grandTotalEl = document.getElementById('grand-total');
            const saveOrderBtn = document.getElementById('save-order-btn');
            const newOrderBtn = document.getElementById('new-order-btn');
            const sendCurrentOrderBtn = document.getElementById('send-current-order-btn'); 
            const removeAllOrdersBtn = document.getElementById('remove-all-orders-btn');
            const savedOrdersListEl = document.getElementById('saved-orders-list');
            
            const custNameEl = document.getElementById('cust-name');
            const custContactEl = document.getElementById('cust-contact');
            const custAddressEl = document.getElementById('cust-address');
            const custNoteEl = document.getElementById('cust-note');
            const emptyCartMsgEl = document.querySelector('.empty-cart-msg');
            
            // Removed custom modal elements


            let cart = {}; 
            let currentCategory = allCategories[0]; 

            // --- 3. Removed Custom Modal Helper (Reverted to window.confirm/alert) ---

            
            // --- 4. LOCAL STORAGE HELPERS ---
            function loadOrders() {
                try {
                    const data = localStorage.getItem(LOCAL_STORAGE_KEY);
                    return data ? JSON.parse(data) : [];
                } catch (e) {
                    console.error("Error loading orders from localStorage:", e);
                    // Reverted to window.alert
                    window.alert("Could not load saved orders. Local storage may be corrupted.");
                    return [];
                }
            }

            function saveOrders(orders) {
                try {
                    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(orders));
                } catch (e) {
                    console.error("Error saving orders to localStorage:", e);
                    // Reverted to window.alert
                    window.alert("Could not save the order. Local storage may be full or blocked.");
                }
            }
            
            // --- 5. Render Product Tabs and Cards ---
            
            function renderCategoryTabs() {
                categoryTabsEl.innerHTML = '';
                allCategories.forEach(category => {
                    const tab = document.createElement('div');
                    tab.className = `category-tab ${category === currentCategory ? 'active' : ''}`;
                    tab.textContent = category;
                    tab.setAttribute('data-category', category);
                    tab.addEventListener('click', () => {
                        currentCategory = category;
                        renderCategoryTabs();
                        renderProductCards(category);
                    });
                    categoryTabsEl.appendChild(tab);
                });
            }

            function renderProductCards(category = currentCategory) {
                const productsToRender = categoriesMap[category] || [];
                productListEl.innerHTML = ''; 
                
                if (productsToRender.length === 0) {
                    productListEl.innerHTML = `<p style="text-align:center; padding: 20px;">No products found in this category.</p>`;
                    return;
                }

                productsToRender.forEach(product => {
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.setAttribute('data-id', product.id);

                    card.innerHTML = `
                        <div class="product-name">${product.name}</div>
                        <div class="product-rate">${CURRENCY_SYMBOL}${product.rate.toFixed(2)}</div>
                        <button class="add-to-cart-btn" data-id="${product.id}">Add</button>
                    `;
                    productListEl.appendChild(card);
                });
            }
            
            productListEl.addEventListener('click', (e) => {
                if (e.target.classList.contains('add-to-cart-btn')) {
                    const productId = parseInt(e.target.getAttribute('data-id'));
                    addToCart(productId);
                }
            });

            // --- 6. Cart Logic ---
            function addToCart(productId) {
                const product = productsById[productId];
                if (!product) return;
                
                if (cart[productId]) {
                    cart[productId].quantity += 1;
                } else {
                    cart[productId] = {
                        id: product.id,
                        name: product.name,
                        rate: product.rate,
                        quantity: 1
                    };
                }
                renderCart();
            }

            function updateQuantity(productId, operation) {
                productId = parseInt(productId);
                if (!cart[productId]) return;

                if (operation === 'add') {
                    cart[productId].quantity += 1;
                } else if (operation === 'subtract') {
                    cart[productId].quantity -= 1;
                }

                if (cart[productId].quantity <= 0) {
                    delete cart[productId];
                }
                renderCart();
            }

            function renderCart() {
                cartItemsEl.innerHTML = '';
                let subtotal = 0;
                let itemCount = 0;

                for (const id in cart) {
                    const item = cart[id];
                    itemCount++;
                    const itemTotal = item.rate * item.quantity;
                    subtotal += itemTotal;

                    const cartItemEl = document.createElement('div');
                    cartItemEl.className = 'cart-item';
                    
                    cartItemEl.innerHTML = `
                        <div class="item-info">${item.name} <span style="font-weight: normal; color: #6c757d;">(${CURRENCY_SYMBOL}${item.rate.toFixed(2)})</span></div>
                        <div class="item-controls">
                            <button class="minus" data-id="${item.id}">-</button>
                            <span class="item-quantity">${item.quantity}</span>
                            <button class="plus" data-id="${item.id}">+</button>
                        </div>
                        <div class="item-total">${CURRENCY_SYMBOL}${itemTotal.toFixed(2)}</div>
                    `;
                    cartItemsEl.appendChild(cartItemEl);
                }

                const cartEmpty = itemCount === 0;
                emptyCartMsgEl.style.display = cartEmpty ? 'block' : 'none';
                saveOrderBtn.disabled = cartEmpty;
                sendCurrentOrderBtn.disabled = cartEmpty; 

                subtotalEl.textContent = `${CURRENCY_SYMBOL}${subtotal.toFixed(2)}`;
                grandTotalEl.textContent = `${CURRENCY_SYMBOL}${subtotal.toFixed(2)}`;

                cartItemsEl.querySelectorAll('.plus').forEach(button => {
                    button.onclick = () => updateQuantity(button.dataset.id, 'add');
                });
                cartItemsEl.querySelectorAll('.minus').forEach(button => {
                    button.onclick = () => updateQuantity(button.dataset.id, 'subtract');
                });
            }
            
            // --- 7. Order Saving, Loading (Edit), and Deletion ---
            
            function renderSavedOrders() {
                const orders = loadOrders();
                savedOrdersListEl.innerHTML = '';

                if (orders.length === 0) {
                    savedOrdersListEl.innerHTML = '<div class="no-saved-orders p-2 text-center text-gray-500">No saved orders found.</div>';
                    removeAllOrdersBtn.disabled = true;
                    return;
                }
                
                removeAllOrdersBtn.disabled = false;
                orders.sort((a, b) => b.timestamp - a.timestamp); 

                orders.forEach(order => {
                    const orderItem = document.createElement('div');
                    orderItem.className = 'saved-order-item';
                    orderItem.setAttribute('data-id', order.id);

                    const date = new Date(order.timestamp).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });

                    orderItem.innerHTML = `
                        <div class="order-info">
                            <strong>${order.customer.name}</strong>
                            <small>${date} | ${CURRENCY_SYMBOL}${order.total.toFixed(2)}</small>
                        </div>
                        <div class="order-actions">
                            <button class="edit-order-btn" data-id="${order.id}">Edit/Load</button>
                            <button class="send-order-btn-small" data-id="${order.id}">Send</button>
                            <button class="remove-order-btn" data-id="${order.id}">Remove</button>
                        </div>
                    `;
                    savedOrdersListEl.appendChild(orderItem);
                });

                // Attach event listeners for the newly rendered elements
                savedOrdersListEl.querySelectorAll('.edit-order-btn').forEach(el => {
                    el.addEventListener('click', (e) => loadExistingOrder(e.currentTarget.getAttribute('data-id')));
                });
                savedOrdersListEl.querySelectorAll('.remove-order-btn').forEach(el => {
                    el.addEventListener('click', (e) => removeSavedOrder(e.currentTarget.getAttribute('data-id')));
                });
                savedOrdersListEl.querySelectorAll('.send-order-btn-small').forEach(el => {
                    el.addEventListener('click', (e) => sendOrderDirectly(e.currentTarget.getAttribute('data-id')));
                });
            }

            async function saveCurrentOrder() {
                if (Object.keys(cart).length === 0) {
                    // Reverted to window.alert
                    window.alert("Cannot save an empty order.");
                    return;
                }
                const name = custNameEl.value.trim();
                const contact = custContactEl.value.trim();

                if (!name || !contact) {
                    // Reverted to window.alert
                    window.alert("Please fill in Customer Name and Contact details before saving.");
                    return;
                }
                
                let orders = loadOrders();
                const currentTotal = parseFloat(grandTotalEl.textContent.replace(CURRENCY_SYMBOL, ''));
                
                const newOrder = {
                    id: Date.now().toString(), 
                    timestamp: Date.now(),
                    customer: {
                        name: name,
                        contact: contact,
                        address: custAddressEl.value.trim(),
                        note: custNoteEl.value.trim() 
                    },
                    cart: JSON.parse(JSON.stringify(cart)), 
                    total: currentTotal
                };
                
                orders.push(newOrder);
                saveOrders(orders);
                renderSavedOrders();
                
                startNewOrder(false); 
                
                // Reverted to window.alert
                window.alert(`Order for ${name} saved successfully! The form has been cleared for a new order.`);
            }

            function loadExistingOrder(orderId) {
                const orders = loadOrders();
                const orderToLoad = orders.find(o => o.id === orderId);

                if (!orderToLoad) {
                    // Reverted to window.alert
                    window.alert("Order not found!");
                    return;
                }
                
                custNameEl.value = orderToLoad.customer.name;
                custContactEl.value = orderToLoad.customer.contact;
                custAddressEl.value = orderToLoad.customer.address;
                custNoteEl.value = orderToLoad.customer.note;

                cart = orderToLoad.cart;
                renderCart();
                
                removeSavedOrder(orderId, false); 
                // Reverted to window.alert
                window.alert(`Order for ${orderToLoad.customer.name} loaded for editing. Click 'Save Order & Clear' when done.`);
            }

            async function removeSavedOrder(orderId, requireConfirm = true) {
                if (requireConfirm) {
                    // Reverted to window.confirm
                    const confirmed = window.confirm("Are you sure you want to remove this saved order?");
                    if (!confirmed) return;
                }
                let orders = loadOrders();
                orders = orders.filter(o => o.id !== orderId);
                saveOrders(orders);
                renderSavedOrders();
            }

            async function clearAllOrders() {
                // Reverted to window.confirm
                 const confirmed = window.confirm("WARNING: Are you sure you want to remove ALL saved orders? This cannot be undone.");
                 if (!confirmed) return;
                
                localStorage.removeItem(LOCAL_STORAGE_KEY);
                renderSavedOrders();
                // Reverted to window.alert
                window.alert("All saved orders have been removed.");
            }

            async function startNewOrder(requireConfirm = true) {
                if (requireConfirm && Object.keys(cart).length > 0) {
                    // Reverted to window.confirm
                    const confirmed = window.confirm("This will clear the current cart and customer details. Proceed?");
                    if (!confirmed) return;
                }
                cart = {};
                custNameEl.value = '';
                custContactEl.value = '';
                custAddressEl.value = '';
                custNoteEl.value = ''; 
                renderCart();
                if (requireConfirm) {
                    // Reverted to window.alert
                    window.alert("New Blank Order started. Cart and details cleared.");
                }
            }
            
            // --- 8. WhatsApp Order Functionality ---
            
            function getADDateString() {
                const now = new Date();
                
                const dateOptions = {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                };
                
                const formattedDate = now.toLocaleDateString('en-US', dateOptions);

                return `*Order Date: ${formattedDate}*\n`;
            }

            function generateWhatsAppMessage(cartData, customerDetails, total) {
                const dateHeader = getADDateString();
                let message = `${dateHeader}\n`; 
                
                message += `\n*Customer Details:*\n`;
                message += `Name: ${customerDetails.name}\n`;
                message += `Contact: ${customerDetails.contact}\n`;
                if (customerDetails.address) message += `Address: ${customerDetails.address}\n`;
                
                message += `\n*Order Items:*\n`;

                let itemDetails = '';
                
                for (const id in cartData) {
                    const item = cartData[id];
                    const itemTotal = item.rate * item.quantity;
                    itemDetails += `${item.quantity} x ${item.name} (@${CURRENCY_SYMBOL}${item.rate.toFixed(2)}) = ${CURRENCY_SYMBOL}${itemTotal.toFixed(2)}\n`;
                }

                message += itemDetails;
                
                message += `\n*Grand Total: ${CURRENCY_SYMBOL}${total.toFixed(2)}*\n`;
                
                if (customerDetails.note) message += `*Note:* ${customerDetails.note}\n`;
                
                return message;
            }

            async function sendOrderDirectly(orderId = null) {
                let order;
                
                if (orderId) { // Sending a SAVED order
                    const orders = loadOrders();
                    order = orders.find(o => o.id === orderId);
                    if (!order) { 
                        // Reverted to window.alert
                        window.alert("Error: Saved order not found.");
                        return;
                    }
                } else { // Sending the CURRENT (unsaved) order
                    if (Object.keys(cart).length === 0) {
                        // Reverted to window.alert
                        window.alert("Cannot send an empty order.");
                        return;
                    }
                    const name = custNameEl.value.trim();
                    const contact = custContactEl.value.trim();
                    
                    if (!name || !contact) {
                        // Reverted to window.alert
                        window.alert("Please enter Customer Name and Contact Number before sending the current order.");
                        return;
                    }

                    const currentTotal = parseFloat(grandTotalEl.textContent.replace(CURRENCY_SYMBOL, ''));
                    order = {
                        customer: {
                            name: name,
                            contact: contact,
                            address: custAddressEl.value.trim(),
                            note: custNoteEl.value.trim() 
                        },
                        cart: JSON.parse(JSON.stringify(cart)), 
                        total: currentTotal
                    };
                }

                const message = generateWhatsAppMessage(order.cart, order.customer, order.total);
                const encodedMessage = encodeURIComponent(message);
                
                // Open WhatsApp link without a recipient number, forcing the user to pick a contact
                const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
                    
                window.open(whatsappUrl, '_blank');
            }
            
            // --- 9. KEYBOARD NAVIGATION LOGIC ---
            
            // 1. Define the desired focus order
            const focusOrder = [
                custNameEl,
                custContactEl,
                custAddressEl,
                custNoteEl,
            ];
            
            // 2. Function to handle Enter key press
            function handleEnterKey(e) {
                // Check if the key pressed is 'Enter' or 'NumpadEnter'
                if (e.key === 'Enter') {
                    e.preventDefault(); // Stop the default browser action (like form submission or newline)

                    const currentElement = e.target;
                    const currentIndex = focusOrder.findIndex(el => el === currentElement);

                    if (currentIndex !== -1 && currentIndex < focusOrder.length - 1) {
                        // Move focus to the next element in the order
                        focusOrder[currentIndex + 1].focus();
                    } else if (currentIndex === focusOrder.length - 1) {
                        // If it's the last element (cust-note), move focus to the primary action button
                        saveOrderBtn.focus();
                    }
                }
            }
            
            // 3. Attach the event listener to all elements in the focus order
            focusOrder.forEach(el => {
                el.addEventListener('keydown', handleEnterKey);
            });


            // --- 10. Event Listeners for Control Buttons ---
            saveOrderBtn.addEventListener('click', saveCurrentOrder);
            newOrderBtn.addEventListener('click', () => startNewOrder(true));
            removeAllOrdersBtn.addEventListener('click', clearAllOrders);
            sendCurrentOrderBtn.addEventListener('click', () => sendOrderDirectly(null)); 


            // --- Initial execution ---
            renderCategoryTabs();
            renderProductCards(currentCategory);
            renderCart();
            renderSavedOrders();
        });
    </script>
</body>
</html>

